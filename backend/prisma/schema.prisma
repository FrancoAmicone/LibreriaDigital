generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}
model User {
  id              String           @id @default(cuid())
  name            String?
  email           String           @unique
  image           String?
  role            Role             @default(USER)
  status          Status           @default(PENDING)
  heldBooks       Book[]           @relation("HolderRelation")
  ownedBooks      Book[]           @relation("OwnerRelation")
  lendingRequests LendingRequest[]
  notifications   Notification[]
}

model Book {
  id              String           @id @default(cuid())
  title           String
  author          String
  isbn            String?
  thumbnail       String?
  isAvailable     Boolean          @default(true)
  createdAt       DateTime         @default(now()) @db.Timestamptz(6)
  ownerId         String
  currentHolderId String
  currentHolder   User             @relation("HolderRelation", fields: [currentHolderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  owner           User             @relation("OwnerRelation", fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lendingRequests LendingRequest[]
}

model LendingRequest {
  id          String        @id @default(cuid())
  bookId      String
  requesterId String
  status      LendingStatus @default(PENDING)
  createdAt   DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime      @updatedAt @db.Timestamptz(6)
  
  book        Book          @relation(fields: [bookId], references: [id], onDelete: Cascade)
  requester   User          @relation(fields: [requesterId], references: [id], onDelete: Cascade)
  
  @@index([bookId])
  @@index([requesterId])
  @@index([status])
}

enum Role {
  ADMIN
  USER
}

enum Status {
  PENDING
  ACTIVE
}

enum LendingStatus {
  PENDING
  APPROVED
  DELIVERED
  REJECTED
  RETURNED
  CANCELLED
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  message   String
  type      String   // e.g., "REQUEST", "APPROVAL", "CANCELLATION"
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now()) @db.Timestamptz(6)

  @@index([userId])
  @@map("notifications")
}
